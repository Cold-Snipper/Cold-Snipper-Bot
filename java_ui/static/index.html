<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>COLD BOT Local UI</title>
    <link rel="stylesheet" href="/styles.css" />
  </head>
  <body>
    <header>
      <h1>COLD BOT Local UI</h1>
      <p>
        Local-first scanning and outreach testing UI. Focused on FSBO discovery,
        contact extraction, and safe, manual review before outreach.
      </p>
    </header>

    <div class="tabs">
      <button class="tab active" data-tab="scanner">Scanner</button>
      <button class="tab" data-tab="client-communications">Client Communciations</button>
      <button class="tab" data-tab="stages">Stages</button>
    </div>

    <div class="tab-content active" id="tab-scanner">
      <section class="panel">
        <div class="status">
          <div>
            <span class="label">Uptime</span>
            <span id="uptime">-</span>
          </div>
          <div>
            <span class="label">Last action</span>
            <span id="last-action">-</span>
          </div>
          <div>
            <span class="label">Actions</span>
            <span id="action-count">-</span>
          </div>
          <div>
            <span class="label">Logs</span>
            <span id="log-count">-</span>
          </div>
          <div>
            <span class="label">DB Leads</span>
            <span id="db-count">-</span>
          </div>
          <div>
            <span class="label">Client Comms</span>
            <span id="comm-count">-</span>
          </div>
          <div>
            <span class="label">CRM Clients</span>
            <span id="client-count">-</span>
          </div>
          <div>
            <span class="label">FB Queue</span>
            <span id="fb-queue-count">-</span>
          </div>
          <div>
            <span class="label">Scan State</span>
            <span id="scan-state">-</span>
          </div>
          <div>
            <span class="label">Last Scan</span>
            <span id="last-scan">-</span>
          </div>
        </div>
      </section>

      <section class="panel">
        <h2>Scan Mode</h2>
        <div class="toggle-row">
          <label class="toggle">
            <input type="radio" name="scan-mode" value="website" checked />
            Website Scrape (into database + CRM)
          </label>
          <label class="toggle">
            <input type="radio" name="scan-mode" value="facebook" />
            FB Marketplace Search (logged-in user)
          </label>
        </div>
      </section>

      <div class="mode-grid">
        <section class="mode-panel active" id="website-scan-setup">
          <div class="mode-header">
            <h2>Website Scrape Setup</h2>
            <span class="mode-pill">Database + CRM</span>
          </div>
          <div class="settings-stack">
            <div class="settings-group">
              <div class="settings-title">Targets</div>
              <p class="hint-text"><strong>Start Scan</strong> and <strong>Test Single Page</strong> run a real browser (Playwright): they open your start URL(s), scroll the page, and extract listing links/cards using the Listing Selector. New leads are appended to the table below. <strong>Send via Website Forms</strong> visits each pending lead URL and submits the message in the first contact form found. Refresh leads after each run.</p>
              <div class="form-grid">
                <label>
                  Country (EU)
                  <select id="country">
                    <option value="">Loading EU countries...</option>
                  </select>
                </label>
                <label>
                  Target Site
                  <select id="target-site">
                    <option value="">Select target site</option>
                  </select>
                </label>
                <label>
                  Listing type
                  <select id="listing-type">
                    <option value="">—</option>
                  </select>
                </label>
                <label>
                  Start URLs <span class="label-optional">(built from above)</span>
                  <textarea id="start-urls" rows="3" placeholder="Select country, site and listing type to build URLs"></textarea>
                </label>
              </div>
            </div>

            <div class="settings-group">
              <div class="settings-title">Filters</div>
              <div class="form-grid">
                <label>
                  Criteria (FSBO keywords)
                  <textarea id="criteria" rows="3">FSBO, for sale by owner, owner selling, motivated seller</textarea>
                </label>
                <label>
                  City
                  <input id="city" type="text" value="Miami" />
                </label>
                <label>
                  Max Price
                  <input id="max-price" type="text" value="500000" />
                </label>
              </div>
            </div>

            <div class="settings-group">
              <div class="settings-title">Advanced</div>
              <div class="form-grid">
                <label>
                  Listing Selector
                  <input id="listing-selector" type="text" value='[data-testid="marketplace_feed_card"]' />
                </label>
                <label>
                  Single Page URL
                  <input id="single-url" type="text" value="https://www.athome.lu/buy/apartment/luxembourg/id-0000000.html" />
                </label>
              </div>
            </div>
            <div class="settings-group">
              <div class="settings-title">Outreach (Websites)</div>
              <div class="form-grid">
                <label>
                  Message Template
                  <textarea id="site-message" rows="4">Hi! I saw your listing and wondered if you'd consider working with a local agent to get more exposure and qualified buyers. Happy to help with zero upfront costs.</textarea>
                </label>
                <label>
                  Send Limit
                  <input id="site-send-limit" type="text" placeholder="5" />
                </label>
                <label class="checkbox">
                  <input id="site-headless" type="checkbox" />
                  Run headless
                </label>
              </div>
              <div class="buttons">
                <button data-action="site_send_messages">Send via Website Forms</button>
              </div>
            </div>
          </div>
          <div class="buttons">
            <button data-action="start_scan">Start Scan</button>
            <button data-action="pause_scan">Pause Scan</button>
            <button data-action="stop_scan">Stop Scan</button>
            <button data-action="test_single_page">Test Single Page</button>
            <button class="secondary" data-action="preview_results">Preview Results</button>
          </div>
        </section>

        <section class="mode-panel" id="facebook-scan-setup">
          <div class="mode-header">
            <h2>Facebook scan</h2>
            <span class="mode-pill">Marketplace or Groups → Analyze → Contact</span>
          </div>
          <div class="settings-stack">
            <div class="settings-group">
              <div class="settings-title">Source</div>
              <div class="form-grid">
                <label>
                  Type
                  <select id="fb-source-type">
                    <option value="marketplace">Marketplace</option>
                    <option value="groups">Groups</option>
                  </select>
                </label>
              </div>
            </div>
            <div class="settings-group fb-marketplace-only">
              <div class="settings-title">Marketplace – Location</div>
              <div class="form-grid">
                <label>
                  City
                  <input id="fb-city" type="text" placeholder="e.g. miami" value="miami" />
                </label>
                <label>
                  Radius (km)
                  <input id="fb-radius" type="text" placeholder="25" value="25" />
                </label>
                <label>
                  Main Category
                  <select id="fb-category">
                    <option value="">Select category</option>
                    <option value="property" selected>Property for Sale</option>
                    <option value="rentals">Property for Rent</option>
                    <option value="rooms">Rooms for Rent</option>
                    <option value="commercial">Commercial</option>
                    <option value="land">Land</option>
                  </select>
                </label>
                <label>
                  Keywords
                  <input id="fb-keywords" type="text" placeholder="FSBO, owner, no agent" />
                </label>
              </div>
              <div class="form-grid">
                <label>
                  FB Search URL <span class="hint">(built from city + radius)</span>
                  <input id="fb-search-url" type="text" value="https://www.facebook.com/marketplace/miami/propertyforsale" />
                </label>
              </div>
            </div>
            <div class="settings-group fb-groups-only" style="display:none;">
              <div class="settings-title">Groups – URLs</div>
              <div class="form-grid">
                <label>
                  Group URLs (one per line)
                  <textarea id="fb-group-urls" rows="4" placeholder="https://www.facebook.com/groups/..."></textarea>
                </label>
              </div>
            </div>
            <div class="settings-group fb-marketplace-only">
              <div class="settings-title">Marketplace – Filters</div>
              <div class="form-grid">
                <label>
                  Property Type
                  <select id="fb-property-type">
                    <option value="">Any</option>
                    <option value="house">House</option>
                    <option value="apartment">Apartment</option>
                    <option value="condo">Condo</option>
                    <option value="townhouse">Townhouse</option>
                    <option value="studio">Studio</option>
                    <option value="duplex">Duplex</option>
                    <option value="land">Land</option>
                  </select>
                </label>
                <label>
                  Min Price
                  <input id="fb-min-price" type="text" placeholder="100000" />
                </label>
                <label>
                  Max Price
                  <input id="fb-max-price" type="text" placeholder="500000" />
                </label>
                <label>
                  Bedrooms (min)
                  <input id="fb-bedrooms" type="text" placeholder="2" />
                </label>
                <label>
                  Bathrooms (min)
                  <input id="fb-bathrooms" type="text" placeholder="1" />
                </label>
                <label>
                  Size Min (m²)
                  <input id="fb-size-min" type="text" placeholder="60" />
                </label>
                <label>
                  Size Max (m²)
                  <input id="fb-size-max" type="text" placeholder="200" />
                </label>
                <label>
                  Posted within (days)
                  <input id="fb-posted-within" type="text" placeholder="7" />
                </label>
                <label>
                  Language
                  <select id="fb-language">
                    <option value="">Any</option>
                    <option value="en">English</option>
                    <option value="fr">French</option>
                    <option value="de">German</option>
                    <option value="es">Spanish</option>
                    <option value="pt">Portuguese</option>
                    <option value="it">Italian</option>
                    <option value="nl">Dutch</option>
                  </select>
                </label>
                <label class="checkbox">
                  <input id="fb-fsbo-only" type="checkbox" />
                  FSBO Only
                </label>
              </div>
            </div>
            <div class="settings-group">
              <div class="settings-title">Session</div>
              <div class="form-grid">
                <label>
                  Logged-in User
                  <select id="fb-logged-in">
                    <option value="true">Yes (use logged-in session)</option>
                    <option value="false">No</option>
                  </select>
                </label>
              </div>
            </div>
            <div class="settings-group">
              <div class="settings-title">Actions</div>
              <p class="hint-text"><strong>Analyze Feed</strong> opens a real browser (Playwright), loads the Marketplace or Group URL(s), scrolls the feed, and appends listing links to the queue below. Use Marketplace (city + keywords) or Groups (one URL per line). Refresh the queue table after the scan finishes. <strong>Save URLs</strong> is for adding mock URLs only.</p>
              <div class="buttons">
                <button data-action="fb_analyze">Analyze Feed</button>
                <button data-action="fb_save_urls">Save URLs</button>
                <button class="secondary" data-action="fb_mark_contacted">Mark Contacted</button>
                <button class="secondary" data-action="fb_clear_queue">Clear Queue</button>
              </div>
            </div>
            <div class="settings-group">
              <div class="settings-title">Send via Browser</div>
              <div class="form-grid">
                <label>
                  Message Template
                  <textarea id="fb-message" rows="4">Hi! I saw your listing and wondered if you'd consider working with a local agent to get more exposure and qualified buyers. Happy to help with zero upfront costs.</textarea>
                </label>
                <label>
                  Send Limit
                  <input id="fb-send-limit" type="text" placeholder="5" />
                </label>
                <label class="checkbox">
                  <input id="fb-headless" type="checkbox" />
                  Run headless
                </label>
              </div>
              <div class="buttons">
                <button data-action="fb_send_messages">Send Messages (Browser)</button>
              </div>
            </div>
          </div>

          <div class="table-wrap compact">
            <table>
              <thead>
                <tr>
                  <th></th>
                  <th>ID</th>
                  <th>URL</th>
                  <th>Status</th>
                  <th>Saved At</th>
                </tr>
              </thead>
              <tbody id="fb-queue-body"></tbody>
            </table>
          </div>
        </section>
      </div>


      <section class="panel">
        <h2>Database</h2>
        <div class="form-row">
          <input id="search-query" type="text" placeholder="Search DB (e.g., Miami, $500k, FSBO)" />
          <button data-action="search_db" class="secondary">Search DB</button>
          <button data-action="view_all_leads" class="secondary">View All Leads</button>
          <button data-action="refresh_leads" class="secondary">Refresh Leads</button>
        </div>
        <div class="buttons">
          <button data-action="mark_contacted">Mark as Contacted</button>
          <button data-action="delete_selected">Delete Selected</button>
          <button class="secondary" data-action="export_csv">Export to CSV</button>
          <button class="secondary" data-action="backup_db">Backup DB</button>
          <button class="danger" data-action="clear_database">Clear Database</button>
        </div>
      </section>

      <section class="panel">
        <h2>Config / LLM Testing</h2>
        <div class="form-grid">
          <label>
            Config Path
            <input id="config-path" type="text" value="config.yaml" />
          </label>
          <label>
            Sample Listing Text (LLM Test)
            <textarea id="prompt-text" rows="4">House for sale by owner, 3 bed, 2 bath in Miami. Text me at 305-555-1212.</textarea>
          </label>
        </div>
        <div class="buttons">
          <button data-action="load_config">Load Config</button>
          <button data-action="save_config">Save Config</button>
          <button class="secondary" data-action="test_llm_prompt">Test LLM Prompt</button>
          <button class="secondary" data-action="clear_logs">Clear Logs</button>
        </div>
        <div id="action-response" class="response"></div>
      </section>

      <section class="panel">
        <h2>Leads Preview</h2>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th></th>
                <th>ID</th>
                <th>Title</th>
                <th>Price</th>
                <th>Location</th>
                <th>Status</th>
                <th>Email</th>
                <th>Phone</th>
                <th>Scan Time</th>
              </tr>
            </thead>
            <tbody id="leads-body"></tbody>
          </table>
        </div>
      </section>

      <section class="panel">
        <h2>Output Monitor</h2>
        <div id="log-list" class="logs"></div>
      </section>
    </div>

    <div class="tab-content" id="tab-client-communications">
      <section class="panel">
        <h2>CRM Dashboard</h2>
        <div class="summary-grid">
          <div class="card">
            <div class="card-label">Total Leads</div>
            <div class="card-value" id="crm-total">0</div>
          </div>
          <div class="card">
            <div class="card-label">Viable Leads (Score ≥ 7)</div>
            <div class="card-value" id="crm-viable">0</div>
          </div>
          <div class="card">
            <div class="card-label">Contacted</div>
            <div class="card-value" id="crm-contacted">0</div>
          </div>
          <div class="card">
            <div class="card-label">Converted</div>
            <div class="card-value" id="crm-converted">0%</div>
          </div>
          <div class="card">
            <div class="card-label">Automation Enabled</div>
            <div class="card-value" id="crm-auto">0</div>
          </div>
        </div>
        <div class="form-row">
          <button class="secondary" data-action="refresh_clients">Refresh Data</button>
          <button class="secondary" data-action="export_clients">Export Summary</button>
          <label class="toggle">
            <input id="crm-global-auto" type="checkbox" />
            Global Auto-Outreach
          </label>
        </div>
      </section>

      <section class="panel">
        <div class="crm-tabs">
          <button class="tab-btn active" data-crm-tab="all">All Leads</button>
          <button class="tab-btn" data-crm-tab="website">Website Outreach</button>
          <button class="tab-btn" data-crm-tab="facebook">FB Outreach</button>
        </div>
        <div class="crm-filters">
          <label>
            Progress Stage
            <select id="crm-stage-filter">
              <option value="">All</option>
              <option value="new">New</option>
              <option value="qualified">Qualified</option>
              <option value="contacted">Contacted</option>
              <option value="proposal_sent">Proposal Sent</option>
              <option value="negotiation">Negotiation</option>
              <option value="won">Won</option>
              <option value="lost">Lost</option>
            </select>
          </label>
          <label>
            Source Type
            <select id="crm-source-filter">
              <option value="">All</option>
              <option value="website">Website</option>
              <option value="facebook">Facebook</option>
            </select>
          </label>
          <label>
            Outreach Channel
            <select id="crm-channel-filter">
              <option value="">All</option>
              <option value="email">Email</option>
              <option value="forms">Website Forms</option>
              <option value="messenger">Messenger</option>
            </select>
          </label>
          <label>
            Min Viability Score
            <input id="crm-score-filter" type="text" placeholder="7" />
          </label>
          <label>
            Automation
            <select id="crm-auto-filter">
              <option value="">All</option>
              <option value="true">Enabled</option>
              <option value="false">Manual</option>
            </select>
          </label>
          <label>
            Search
            <input id="client-search" type="text" placeholder="Name, email, notes..." />
          </label>
          <button class="secondary" data-action="search_clients">Apply Filters</button>
        </div>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th></th>
                <th>ID/Name</th>
                <th>Source</th>
                <th>Details</th>
                <th>Viability</th>
                <th>Contact</th>
                <th>Progress</th>
                <th>Automation</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="clients-body"></tbody>
          </table>
        </div>
        <div class="buttons">
          <button data-action="update_client">Update Selected</button>
          <button class="secondary" data-action="delete_client">Delete Selected</button>
        </div>
      </section>

      <section class="panel">
        <div class="crm-grid">
          <div class="crm-panel">
            <div class="crm-header">
              <h3>Client Panel</h3>
              <span id="client-panel-title" class="mode-pill">Select a client</span>
            </div>
            <div class="client-card" id="client-detail">
              <div class="client-row"><span>Name</span><strong id="detail-name">-</strong></div>
              <div class="client-row"><span>Email</span><strong id="detail-email">-</strong></div>
              <div class="client-row"><span>Phone</span><strong id="detail-phone">-</strong></div>
              <div class="client-row"><span>Status</span><strong id="detail-status">-</strong></div>
              <div class="client-row"><span>Stage</span><strong id="detail-stage">-</strong></div>
              <div class="client-row"><span>Viability</span><strong id="detail-viability">-</strong></div>
              <div class="client-row"><span>Source</span><strong id="detail-source">-</strong></div>
              <div class="client-row"><span>Channel</span><strong id="detail-channel">-</strong></div>
              <div class="client-row"><span>Last Interaction</span><strong id="detail-last-contacted">-</strong></div>
              <div class="client-row"><span>Notes</span><strong id="detail-notes">-</strong></div>
            </div>
            <div class="settings-group">
              <div class="settings-title">Log Communication</div>
              <div class="form-grid">
                <label>
                  Contact Name
                  <input id="comm-name" type="text" placeholder="Owner name" />
                </label>
                <label>
                  Contact Email
                  <input id="comm-email" type="email" placeholder="owner@email.com" />
                </label>
                <label>
                  Contact Phone
                  <input id="comm-phone" type="text" placeholder="+352 000 000" />
                </label>
                <label>
                  Channel
                  <select id="comm-channel">
                    <option value="email">Email</option>
                    <option value="phone">Phone</option>
                    <option value="sms">SMS</option>
                    <option value="whatsapp">WhatsApp</option>
                  </select>
                </label>
                <label>
                  Status
                  <select id="comm-status">
                    <option value="pending">Pending</option>
                    <option value="contacted">Contacted</option>
                    <option value="responded">Responded</option>
                    <option value="closed">Closed</option>
                  </select>
                </label>
                <label>
                  Notes
                  <textarea id="comm-notes" rows="3" placeholder="Short notes..."></textarea>
                </label>
                <label>
                  Last Message
                  <textarea id="comm-message" rows="3" placeholder="Last message sent or received..."></textarea>
                </label>
              </div>
              <div class="buttons">
                <button data-action="add_comm">Log Communication</button>
                <button class="secondary" data-action="update_comm_status">Update Comm Status</button>
                <button class="secondary" data-action="refresh_comms">Refresh Comms</button>
                <button class="secondary" data-action="export_comms">Export Comms</button>
              </div>
              <div class="form-row">
                <input id="comm-search" type="text" placeholder="Search communications..." />
                <button class="secondary" data-action="search_comms">Search</button>
                <button class="secondary" data-action="delete_comm">Delete Selected</button>
                <button class="danger" data-action="clear_comms">Clear Comms</button>
              </div>
            </div>
          </div>

          <div class="crm-panel">
            <div class="crm-header">
              <h3>Add / Update Lead</h3>
              <span class="mode-pill">Core Data</span>
            </div>
            <div class="settings-group">
              <div class="settings-title">Lead Info</div>
              <div class="form-grid">
                <label>
                  Name
                  <input id="client-name" type="text" placeholder="Client name" />
                </label>
                <label>
                  Email
                  <input id="client-email" type="email" placeholder="client@email.com" />
                </label>
                <label>
                  Phone
                  <input id="client-phone" type="text" placeholder="+352 000 000" />
                </label>
                <label>
                  Status
                  <select id="client-status">
                    <option value="active">Active</option>
                    <option value="paused">Paused</option>
                    <option value="closed">Closed</option>
                  </select>
                </label>
                <label>
                  Stage
                  <select id="client-stage">
                    <option value="new">New</option>
                    <option value="qualified">Qualified</option>
                    <option value="contacted">Contacted</option>
                    <option value="proposal_sent">Proposal Sent</option>
                    <option value="negotiation">Negotiation</option>
                    <option value="won">Won</option>
                    <option value="lost">Lost</option>
                  </select>
                </label>
                <label>
                  Source
                  <input id="client-source" type="text" placeholder="website / facebook / referral" />
                </label>
                <label>
                  Source Type
                  <select id="client-source-type">
                    <option value="">Select</option>
                    <option value="website">Website</option>
                    <option value="facebook">Facebook</option>
                  </select>
                </label>
                <label>
                  Outreach Channel
                  <select id="client-outreach-channel">
                    <option value="">Select</option>
                    <option value="email">Email</option>
                    <option value="forms">Website Forms</option>
                    <option value="messenger">Messenger</option>
                  </select>
                </label>
                <label>
                  Viability Score (1-10)
                  <input id="client-viability-score" type="text" placeholder="8" />
                </label>
                <label class="checkbox">
                  <input id="client-automation-enabled" type="checkbox" />
                  Automation Enabled
                </label>
                <label>
                  Notes
                  <textarea id="client-notes" rows="3" placeholder="Client notes..."></textarea>
                </label>
              </div>
              <div class="buttons">
                <button data-action="add_client">Add Lead</button>
                <button class="secondary" data-action="update_client">Update Selected</button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <div class="tab-content" id="tab-stages">
      <section class="panel">
        <h2>Workflow Stages Overview</h2>
        <p>
          This page shows the full Cold Bot pipeline from configuration to outreach and CRM,
          with each stage's purpose, inputs, outputs, and a live operational status.
        </p>
      </section>

      <section class="panel">
        <div class="mode-header">
          <h2>Stage 1 – Setup & Source Selection</h2>
          <span class="mode-pill" id="stage-config-status">Unknown</span>
        </div>
        <div class="settings-stack">
          <div class="settings-group">
            <div class="settings-title">How it works (flow)</div>
            <div class="stage1-flow">
              <div class="flow-node">Start</div>
              <div class="flow-arrow">↓</div>
              <div class="flow-node">Prompt: 1=Websites, 2=Facebook, 3=Both</div>
              <div class="flow-arrow">↓</div>
              <div class="flow-node">Validate choice (reprompt up to 3× if invalid)</div>
              <div class="flow-arrow">↓</div>
              <div class="flow-node">Merge into config → <code>source_type</code> + <code>agents_handling</code></div>
              <div class="flow-arrow">↓</div>
              <div class="flow-node">Write <code>config.yaml</code></div>
              <div class="flow-arrow">↓</div>
              <div class="flow-node">Proceed to Phase 2 (parameters)</div>
            </div>
          </div>
          <div class="settings-group">
            <div class="settings-title">Inputs</div>
            <ul>
              <li>User choice: websites / facebook / both</li>
              <li>Existing <code>config.yaml</code> (optional)</li>
            </ul>
          </div>
          <div class="settings-group">
            <div class="settings-title">Outputs</div>
            <ul>
              <li><code>config.source_type</code> and basic filters/URLs</li>
              <li><code>agents_handling = "log_and_export"</code> (default)</li>
            </ul>
          </div>
          <div class="settings-group">
            <div class="settings-title">Test Stage 1</div>
            <p>Select a source type and apply. This writes to <code>config.yaml</code> in the UI working directory (same as running Phase 1).</p>
            <div class="stage1-test-row">
              <button type="button" class="stage1-btn" data-stage1="websites">Websites</button>
              <button type="button" class="stage1-btn" data-stage1="facebook">Facebook</button>
              <button type="button" class="stage1-btn" data-stage1="both">Both</button>
            </div>
            <div class="stage1-result">
              <span class="label">Current config: </span>
              <strong id="stage1-current">—</strong>
              <span id="stage1-result-msg" class="stage1-msg"></span>
            </div>
          </div>
        </div>
      </section>

      <section class="panel">
        <div class="mode-header">
          <h2>Stage 2 – Scanning Engine</h2>
          <span class="mode-pill" id="stage-scanning-status">Unknown</span>
        </div>
        <div class="settings-stack">
          <div class="settings-group">
            <div class="settings-title">Purpose</div>
            <p>
              Use Playwright to visit target URLs, scroll, and extract raw listing
              text into the Python runtime and leads database.
            </p>
          </div>
          <div class="settings-group">
            <div class="settings-title">Inputs</div>
            <ul>
              <li>Targets from <code>config.yaml</code> (start_urls, selectors, limits)</li>
              <li>Browser session (headless/headful)</li>
            </ul>
          </div>
          <div class="settings-group">
            <div class="settings-title">Outputs</div>
            <ul>
              <li>Raw listings fed into the LLM analysis stage</li>
              <li>Scan status and logs visible in this UI</li>
            </ul>
          </div>
        </div>
      </section>

      <section class="panel">
        <div class="mode-header">
          <h2>Stage 3 – Analysis & Classification</h2>
          <span class="mode-pill" id="stage-analysis-status">Unknown</span>
        </div>
        <div class="settings-stack">
          <div class="settings-group">
            <div class="settings-title">Purpose</div>
            <p>
              Run local LLM checks to decide if a listing is eligible, whether it is
              a private seller or an agent, and how strong the Airbnb potential is.
            </p>
          </div>
          <div class="settings-group">
            <div class="settings-title">Inputs</div>
            <ul>
              <li>Listing text from the scanner</li>
              <li>Criteria and Airbnb rules from <code>config.yaml</code></li>
            </ul>
          </div>
          <div class="settings-group">
            <div class="settings-title">Outputs</div>
            <ul>
              <li>Decision: private vs agent with confidence + reason</li>
              <li>Viability score and qualification factors</li>
            </ul>
          </div>
        </div>
      </section>

      <section class="panel">
        <div class="mode-header">
          <h2>Stage 4 – Contact Extraction & Outreach</h2>
          <span class="mode-pill" id="stage-contacting-status">Unknown</span>
        </div>
        <div class="settings-stack">
          <div class="settings-group">
            <div class="settings-title">Purpose</div>
            <p>
              Extract emails/phones/forms from listings, generate messages, and optionally
              send via email, website forms, or Facebook (dry-run or live).
            </p>
          </div>
          <div class="settings-group">
            <div class="settings-title">Inputs</div>
            <ul>
              <li>Classified private listings with viability scores</li>
              <li>Message templates and limits from <code>config.yaml</code></li>
            </ul>
          </div>
          <div class="settings-group">
            <div class="settings-title">Outputs</div>
            <ul>
              <li>Queued or sent outreach attempts (email, forms, messenger)</li>
              <li>Rate-limited actions to avoid spam/bans</li>
            </ul>
          </div>
        </div>
      </section>

      <section class="panel">
        <div class="mode-header">
          <h2>Stage 5 – Logging & Agents List</h2>
          <span class="mode-pill" id="stage-logging-status">Unknown</span>
        </div>
        <div class="settings-stack">
          <div class="settings-group">
            <div class="settings-title">Purpose</div>
            <p>
              Persist every decision and outreach event to SQLite and text/Excel logs,
              and keep a separate agents list for future partnerships.
            </p>
          </div>
          <div class="settings-group">
            <div class="settings-title">Inputs</div>
            <ul>
              <li>Lead decisions and outreach attempts from Python runtime</li>
              <li>Agent detections (non-private sellers)</li>
            </ul>
          </div>
          <div class="settings-group">
            <div class="settings-title">Outputs</div>
            <ul>
              <li><code>leads.db</code> tables for leads and events</li>
              <li><code>data/agents.txt</code> and <code>data/agents.xlsx</code> exports</li>
            </ul>
          </div>
        </div>
      </section>

      <section class="panel">
        <div class="mode-header">
          <h2>Stage 6 – CRM & Client Communications</h2>
          <span class="mode-pill" id="stage-crm-status">Unknown</span>
        </div>
        <div class="settings-stack">
          <div class="settings-group">
            <div class="settings-title">Purpose</div>
            <p>
              Track leads after first contact: progress stage, viability, follow-ups,
              and logged communications, all visible on the Client Communications tab.
            </p>
          </div>
          <div class="settings-group">
            <div class="settings-title">Inputs</div>
            <ul>
              <li>Imported or synced leads from the core bot</li>
              <li>Manual updates and logged communications from this UI</li>
            </ul>
          </div>
          <div class="settings-group">
            <div class="settings-title">Outputs</div>
            <ul>
              <li>Client records with stages, notes, and automation flags</li>
              <li>Communication history and exportable summaries</li>
            </ul>
          </div>
        </div>
      </section>
    </div>

    <script src="/app.js"></script>
  </body>
</html>
